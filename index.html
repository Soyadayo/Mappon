<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Capital City Explorer</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }
        #map {
            height: 400px;
            width: 100%;
            max-width: 600px;
            margin: 20px auto;
            position: relative;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
        #info {
            margin-top: 20px;
        }
        a {
            color: #0066cc;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <h1>Random Capital City Explorer</h1>
    <button onclick="selectRandomCapital()">Show Random Capital</button>
    <div id="map"></div>
    <div id="info"></div>

    <script>
        // Capital list (20 cities for sample)
        const capitals = [
            {name: "Tokyo", country: "Japan", lat: 35.6762, lng: 139.6503, description: "Tokyo, Japan's capital, is known for its blend of ultramodern skyscrapers and traditional temples."},
            {name: "Paris", country: "France", lat: 48.8566, lng: 2.3522, description: "Paris, France's capital, is famous for its cafe culture and landmarks like the Eiffel Tower."},
            {name: "Brasilia", country: "Brazil", lat: -15.8267, lng: -47.9218, description: "Brasilia, Brazil's capital, is known for its modernist architecture."},
            {name: "Canberra", country: "Australia", lat: -35.2809, lng: 149.1300, description: "Canberra, Australia's capital, hosts national monuments."},
            {name: "Berlin", country: "Germany", lat: 52.5200, lng: 13.4050, description: "Berlin, Germany's capital, is known for its rich history."},
            {name: "New Delhi", country: "India", lat: 28.6139, lng: 77.2090, description: "New Delhi, India's capital, blends ancient and modern."},
            {name: "Washington, D.C.", country: "United States", lat: 38.9072, lng: -77.0369, description: "Washington, D.C., is home to the White House."},
            {name: "Beijing", country: "China", lat: 39.9042, lng: 116.4074, description: "Beijing, China's capital, features the Forbidden City."},
            {name: "Moscow", country: "Russia", lat: 55.7558, lng: 37.6173, description: "Moscow, Russia's capital, is famous for the Kremlin."},
            {name: "Pretoria", country: "South Africa", lat: -25.7479, lng: 28.2293, description: "Pretoria, a capital of South Africa, is known for jacaranda trees."},
            {name: "London", country: "United Kingdom", lat: 51.5074, lng: -0.1278, description: "London, the UK’s capital, is known for Big Ben."},
            {name: "Ottawa", country: "Canada", lat: 45.4215, lng: -75.6972, description: "Ottawa, Canada’s capital, hosts Parliament Hill."},
            {name: "Rome", country: "Italy", lat: 41.9028, lng: 12.4964, description: "Rome, Italy’s capital, is famous for the Colosseum."},
            {name: "Bangkok", country: "Thailand", lat: 13.7563, lng: 100.5018, description: "Bangkok, Thailand’s capital, is known for its vibrant street markets."},
            {name: "Abuja", country: "Nigeria", lat: 9.0579, lng: 7.4951, description: "Abuja, Nigeria’s capital, is a planned city."},
            {name: "Cairo", country: "Egypt", lat: 30.0444, lng: 31.2357, description: "Cairo, Egypt’s capital, is near the pyramids of Giza."},
            {name: "Mexico City", country: "Mexico", lat: 19.4326, lng: -99.1332, description: "Mexico City, Mexico’s capital, is known for its historic center."},
            {name: "Seoul", country: "South Korea", lat: 37.5665, lng: 126.9780, description: "Seoul, South Korea’s capital, blends tradition and modernity."},
            {name: "Jakarta", country: "Indonesia", lat: -6.2088, lng: 106.8456, description: "Jakarta, Indonesia’s capital, is a bustling port city."},
            {name: "Wellington", country: "New Zealand", lat: -41.2865, lng: 174.7762, description: "Wellington, New Zealand’s capital, is known for its windy harbor."}
        ];

        // Global variable to store map instance
        let mapInstance = null;

        function selectRandomCapital() {
            try {
                // Select random capital
                const capital = capitals[Math.floor(Math.random() * capitals.length)];
                console.log("Selected capital:", capital);

                // Validate data
                const { name, country, lat, lng, description } = capital;
                console.log("Extracted data:", { name, country, lat, lng, description });

                if (!name || typeof name !== 'string') {
                    alert("エラー：有効な首都名がありません。");
                    console.error("Invalid or missing name:", name);
                    return;
                }
                if (!country || typeof country !== 'string') {
                    alert("エラー：有効な国名がありません。");
                    console.error("Invalid or missing country:", country);
                    return;
                }
                if (!description || typeof description !== 'string') {
                    alert("エラー：有効な説明がありません。");
                    console.error("Invalid or missing description:", description);
                    return;
                }
                const latitude = parseFloat(lat);
                const longitude = parseFloat(lng);
                if (isNaN(latitude) || isNaN(longitude)) {
                    alert("エラー：無効な座標データです。");
                    console.error("Invalid coordinates:", { lat, lng });
                    return;
                }

                // Generate Google Maps link
                const googleMapsLink = `https://www.google.com/maps?q=${latitude},${longitude}`;

                // Update info display
                document.getElementById('info').innerHTML = `
                    <h2>${name}, ${country}</h2>
                    <p>${description}</p>
                    <p><a href="${googleMapsLink}" target="_blank">Googleマップで表示</a></p>
                `;
                console.log("Info updated with Google Maps link:", googleMapsLink);

                // Initialize or update Leaflet map
                if (mapInstance) {
                    mapInstance.remove();
                    console.log("Previous map removed");
                }
                mapInstance = L.map('map').setView([latitude, longitude], 10);
                console.log("Map initialized with coordinates:", latitude, longitude);

                // Add OpenStreetMap tile layer
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(mapInstance);
                console.log("Tile layer added");

                // Add marker
                L.marker([latitude, longitude])
                    .addTo(mapInstance)
                    .bindPopup(`${name}, ${country}`)
                    .openPopup();
                console.log("Marker added");
            } catch (error) {
                alert("エラー：データの処理中に問題が発生しました。詳細はコンソールを確認してください。");
                console.error("Error in selectRandomCapital:", error);
            }
        }
    </script>
</body>
</html>
